"use strict";angular.module("evtrs.loader",[]).factory("HttpRequestInterceptor",function($rootScope,$q,ENV,$log){var pendingRequests=0,checkUrl=function(config){return ENV.API_ENDPOINT||(ENV.API_ENDPOINT="api"),-1!=config.url.indexOf(ENV.API_ENDPOINT)?!0:!1};return{request:function(config){return config.timeout=ENV.REQUEST_TIMEOUT?ENV.REQUEST_TIMEOUT:2e4,checkUrl(config)&&(pendingRequests++,$rootScope.$broadcast("HTTP_START")),config||$q.when(config)},response:function(response){return checkUrl(response.config)&&0===--pendingRequests&&$rootScope.$broadcast("HTTP_STOP"),response||$q.when(response)},responseError:function(response){return checkUrl(response.config)&&(--pendingRequests||$rootScope.$broadcast("HTTP_STOP")),response.statusText||(response.statusText="No Response"),$log.error(response.status,response.statusText?response.statusText:"UNKNOWN",response.config.url?response.config.url:"UNKNOWN"),$rootScope.$broadcast("STATUS_ERROR",{type:"HTTP_ERROR",code:response.status?response.status:"UNKNOWN",message:response.statusText?response.statusText:"UNKNOWN",cause:response.config.url?response.config.url:"UNKNOWN"}),$q.reject(response)}}}).directive("loader",function(){return{restrict:"E",scope:{},link:function(scope,element,attrs){var spinner=document.createElement("div");switch(attrs.animation){case"box":spinner.setAttribute("class","loader-box");break;case"bounce":spinner.setAttribute("class","loader-bounce");var bounce1=document.createElement("div");bounce1.setAttribute("class","loader-bounce1"),spinner.append(bounce1);var bounce2=document.createElement("div");bounce2.setAttribute("class","loader-bounce2"),spinner.append(bounce2);break;default:spinner.setAttribute("class","loader-box")}element.append(spinner)},controller:function($scope,$element){$scope.$on("HTTP_START",function(){$element.css("display","block")}),$scope.$on("HTTP_STOP",function(){$element.css("display","none")})}}});